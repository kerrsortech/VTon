<!-- Context-Aware Shopify Chatbot Widget -->
<div id="shopify-chatbot-widget-container"></div>

<!-- Load context manager first -->
<script src="{{ 'context-manager.js' | asset_url }}" defer></script>

<!-- Load chatbot widget -->
<script src="{{ 'chatbot.js' | asset_url }}" defer></script>

<!-- Load styles -->
{{ 'styles.css' | asset_url | stylesheet_tag }}

<!-- Configure chatbot -->
<script>
  // Set backend URL from block settings or meta tag
  window.chatbotConfig = {
    backendUrl: '{{ block.settings.backend_url }}',
    shopDomain: '{{ shop.domain }}',
    storeId: '{{ shop.id }}',
    customerId: '{{ customer.id | default: null }}'
  };
  
  // Also set as meta tag for compatibility
  if (!document.querySelector('meta[name="chatbot-backend"]')) {
    const meta = document.createElement('meta');
    meta.name = 'chatbot-backend';
    meta.content = '{{ block.settings.backend_url }}';
    document.head.appendChild(meta);
  }
</script>

{% schema %}
{
  "name": "Context-Aware Chatbot",
  "target": "body",
  "settings": [
    {
      "type": "text",
      "id": "backend_url",
      "label": "Backend API URL",
      "default": "https://your-backend.vercel.app",
      "info": "The URL of your Vercel backend API"
    }
  ]
}
{% endschema %}

